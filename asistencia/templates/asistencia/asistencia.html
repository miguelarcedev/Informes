{% extends "base.html" %}
{% load filtros_meses %}
{% block contenido %}
<div class="container my-3 px-2">
    <h5 class="mb-3 text-center">游늵 {{titulo}}</h5>

    <style>
        /* Encabezado acorde칩n */
        .accordion-button {
            font-size: 0.9rem;
            padding: 0.4rem 0.75rem;
        }

        /* Tablas compactas */
        .table {
            font-size: 0.8rem; /* letras m치s chicas */
        }
        .table th,
        .table td {
            padding: 0.35rem 0.5rem; /* reduce padding */
            vertical-align: middle;
        }
        .table thead th {
            font-size: 0.75rem; /* encabezados a칰n m치s chicos */
            text-transform: uppercase;
        }

        /* Badge (promedio y otros) */
        .badge {
            font-size: 0.7rem;
            padding: 0.35em 0.6em;
        }

        /* Botones */
        .btn {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
    </style>

    <div class="accordion" id="accordionAsistencia">
        {% for anio, datos in data_por_anio.items %}
        <div class="accordion-item shadow-sm rounded-3 mb-2">
            <div class="d-flex justify-content-between align-items-center px-2 py-1 bg-light border-bottom">
                <button class="accordion-button collapsed fw-bold w-100 me-2" type="button" 
                        data-bs-toggle="collapse" data-bs-target="#collapse{{ anio }}" 
                        aria-expanded="false" aria-controls="collapse{{ anio }}">
                    A침o {{ anio }} - Promedio Final: 
                    <span class="badge bg-success ms-2">{{ datos.promedio_final }}</span>
                </button>
                <a href="{% url 'asistencia_pdf' anio titulo %}" 
                   class="btn btn-danger btn-sm d-flex align-items-center">
                    <i class="bi bi-file-earmark-pdf-fill me-1"></i> PDF
                </a>
            </div>
            
            <div id="collapse{{ anio }}" class="accordion-collapse collapse"
                aria-labelledby="heading{{ anio }}" data-bs-parent="#accordionAsistencia">
                <div class="accordion-body p-2">
                    
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-bordered align-middle text-center mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th>Mes</th>
                                    <th>Cant.</th>
                                    <th>Total</th>
                                    <th>Prom.</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for registro in datos.meses %}
                                <tr>
                                    <td>{{ registro.mes|mes_personalizado }}</td>
                                    <td>{{ registro.cantidad }}</td>
                                    <td>{{ registro.total }}</td>
                                    <td><span class="badge bg-primary">{{ registro.promedio }}</span></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>
        </div>
        {% empty %}
        <p class="text-muted small">No hay registros de asistencia.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}
